<div class="modal fade" id="editCompanyModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <form method="POST" action="/company" id="editCompanyForm">
        <div class="modal-header">
          <h5 class="modal-title">Add/Edit Company</h5>
        </div>
        <div class="modal-body">
          <input type="hidden" name="id" id="companyIdInput" />
          <div class="row g-3">
            <div class="col-md-6">
              <label for="companyName" class="form-label">Name</label>
              <input
                type="text"
                class="form-control"
                id="companyName"
                name="name"
                placeholder="Enter Company Name"
                required
              />
            </div>

            <div class="col-md-6">
              <label for="companyEmail" class="form-label">Email</label>
              <input
                type="email"
                class="form-control"
                id="companyEmail"
                name="email"
                placeholder="company@example.com"
              />
            </div>
            <div class="col-md-6">
              <label for="phoneNumber" class="form-label">Phone</label>
              <input
                type="number"
                class="form-control"
                id="phoneNumber"
                name="phone_number"
              />
            </div>
            <div class="col-md-6">
              <label for="gstNumber" class="form-label">GST Number</label>
              <input
                type="text"
                class="form-control text-uppercase"
                id="gstNumber"
                name="gst_number"
                required
              />
          </div>
          <div class="col-md-6">
            <label for="paymentTerm" class="form-label">Payment Term(days)</label>
            <input
              type="number"
              step="1"
              min="0"
              class="form-control"
              id="paymentTerm"
              name="payment_term_days"
              required  
            />
        </div>
        <div class="col-md-12">
            <label for="address" class="form-label">Address</label>
            <textarea
              rows="3"
              class="form-control"
              id="address"
              name="address"  
              placeholder="Enter Address"
            ></textarea>
        </div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            id="closeCompanyModalButton"
            class="btn btn-outline-secondary"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
          <button
            type="submit"
            id="saveCompanyModalButton"
            class="btn btn-primary"
          >
            Save
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const editModalEl = document.getElementById("editCompanyModal");
      const closeButton = document.getElementById("closeCompanyModalButton");

      if (closeButton) {
        closeButton.addEventListener("click", () => {
          if (document.activeElement === closeButton) {
            closeButton.blur();
          }
        });
      }

      if (editModalEl) {
        editModalEl.addEventListener("hide.bs.modal", () => {
          const activeEl = document.activeElement;
          if (activeEl && editModalEl.contains(activeEl)) {
            activeEl.blur();
          }
        });
      }

      if (!editModalEl) {
        return;
      }

      editModalEl.addEventListener("show.bs.modal", function (event) {
        const triggerButton = event.relatedTarget;
        if (!triggerButton) {
          return;
        }

        const companyId = triggerButton.getAttribute("data-id");
        document.getElementById("companyIdInput").value = companyId || "";
        const companyName = triggerButton.getAttribute("data-name");
        document.getElementById("companyName").value = companyName || "";
        document.getElementById("companyEmail").value =
          triggerButton.getAttribute("data-email") || "";
        document.getElementById("phoneNumber").value   = triggerButton.getAttribute("data-phone-number") || "";
        document.getElementById("gstNumber").value = triggerButton.getAttribute("data-gst-number") || "";;
        document.getElementById("paymentTerm").value = triggerButton.getAttribute("data-payment-term-days") || "";
        document.getElementById("address").value =
          triggerButton.getAttribute("data-address") || "";

      

        var modalTitle = document.querySelector(".modal-title");
        modalTitle.textContent = companyName
          ? `Edit Company : ${companyName}`
          : "Add Company";
     
      });
    });
  </script>
  <script>
    document
      .getElementById("editCompanyForm")
      .addEventListener("submit", function (e) {
        e.preventDefault(); // Stop the default form submission

        const formData = new FormData(this);
        const data = Object.fromEntries(formData.entries());
        const actionUrl = this.getAttribute("action");

        const requestMethod =
          data.id == null || data.id === "" ? "POST" : "PATCH";

        console.log("Data:", data);
        fetch(actionUrl, {
          method: requestMethod,
          headers: {
            "Content-Type": "application/json", // Or 'application/x-www-form-urlencoded'
            // Add any necessary headers, e.g., X-CSRF-TOKEN
          },
          body: JSON.stringify(data), // Send data as JSON
        })
          .then((response) => response.json())
          .then((data) => {
            console.log("Success:", data);
            if (data.detail) {
              alert(data.detail);
            } else {
              const closeCompanyModalButton = document.getElementById(
                "closeCompanyModalButton"
              );
              if (closeCompanyModalButton) {
                closeCompanyModalButton.click();
              }
            }

            window.location.reload();
            // Handle success (e.g., show a confirmation message)
          })
          .catch((error) => {
            console.error("Error:", error);
            // Handle errors
          });
      });
  </script>
</div>
